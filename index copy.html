<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AB Test Conversion Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; margin: 2rem; background: #f4f7f6; color: #333; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 150px; margin-bottom: 1rem; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 1rem; }
        button:hover { background: #0056b3; }
        .chart-container { margin-top: 2rem; height: 400px; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 0.5rem; margin-top: 2rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>A/B Test Data Processor</h1>
    <p>Paste your Adobe Analytics tab-separated data below (Date, Control Visits, Variant Visits, Control Conv, Variant Conv):</p>
    
    <textarea id="dataInput" placeholder="2025-12-09	2474	2547	203	222..."></textarea>
    <button onclick="processData()">Generate Graphs</button>

    <h2>Cumulative Conversion Rate (%)</h2>
    <div class="chart-container">
        <canvas id="cumulativeChart"></canvas>
    </div>

    <h2>Daily Conversion Rate (%)</h2>
    <div class="chart-container">
        <canvas id="dailyChart"></canvas>
    </div>
</div>

<script>
let cumulativeChart, dailyChart;

function processData() {
    const input = document.getElementById('dataInput').value.trim();
    if (!input) return alert("Please paste data first");

    const lines = input.split('\n');
    
    const labels = [];
    const dailyControlCR = [];
    const dailyVariantCR = [];
    const cumulativeControlCR = [];
    const cumulativeVariantCR = [];

    let totalControlVisits = 0;
    let totalVariantVisits = 0;
    let totalControlConv = 0;
    let totalVariantConv = 0;

    lines.forEach(line => {
        const cols = line.split('\t');
        if (cols.length < 5) return;

        const date = cols[0];
        const vC = parseInt(cols[1]); // Visits Control
        const vV = parseInt(cols[2]); // Visits Variant
        const cC = parseInt(cols[3]); // Conv Control
        const cV = parseInt(cols[4]); // Conv Variant

        // Daily Calculations
        labels.push(date);
        dailyControlCR.push(((cC / vC) * 100).toFixed(2));
        dailyVariantCR.push(((cV / vV) * 100).toFixed(2));

        // Cumulative Calculations
        totalControlVisits += vC;
        totalVariantVisits += vV;
        totalControlConv += cC;
        totalVariantConv += cV;

        cumulativeControlCR.push(((totalControlConv / totalControlVisits) * 100).toFixed(2));
        cumulativeVariantCR.push(((totalVariantConv / totalVariantVisits) * 100).toFixed(2));
    });

    renderCharts(labels, dailyControlCR, dailyVariantCR, cumulativeControlCR, cumulativeVariantCR);
}

function renderCharts(labels, dC, dV, cC, cV) {
    const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        scales: { y: { beginAtZero: false, title: { display: true, text: 'Conv Rate (%)' } } }
    };

    // Destroy existing charts if they exist to allow re-processing
    if (cumulativeChart) cumulativeChart.destroy();
    if (dailyChart) dailyChart.destroy();

    // Cumulative Chart
    cumulativeChart = new Chart(document.getElementById('cumulativeChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                { label: 'Control (Cumulative)', data: cC, borderColor: '#666', tension: 0.1 },
                { label: 'Variant (Cumulative)', data: cV, borderColor: '#007bff', tension: 0.1 }
            ]
        },
        options: chartOptions
    });

    // Daily Chart
    dailyChart = new Chart(document.getElementById('dailyChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                { label: 'Control (Daily)', data: dC, borderColor: '#ccc', borderDash: [5, 5], tension: 0.3 },
                { label: 'Variant (Daily)', data: dV, borderColor: '#00d1b2', borderDash: [5, 5], tension: 0.3 }
            ]
        },
        options: chartOptions
    });
}
</script>

</body>
</html>